<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZIO - Audit & Pilotage IA</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Styles -->
    <link rel="stylesheet" href="css/style_shared.css">
    <link rel="stylesheet" href="css/style_audit.css">
    <link rel="stylesheet" href="css/style_creator.css">
    <link rel="stylesheet" href="css/style_dashboard.css">
    <link rel="stylesheet" href="css/style_models.css">
    <link rel="stylesheet" href="css/style_reports.css">
    <link rel="stylesheet" href="css/style_deliveries.css">

</head>

<body>
    <header>
        <div class="header-left">
            <div class="menu-wrapper">
                <button id="toggleSidebarBtn" class="btn-icon" title="Menu Principal">â˜°</button>
                <div id="mainMenu" class="dropdown-menu hidden">
                    <div class="menu-section">
                        <h4>Fichiers</h4>
                        <button id="menuLoadBtn" class="menu-item">Charger</button>
                        <button id="menuSaveBtn" class="menu-item" disabled>Sauvegarder</button>
                        <button id="menuExportBtn" class="menu-item" disabled>Exporter</button>
                        <button id="menuResetBtn" class="menu-item text-danger" disabled>RÃ©initialiser</button>
                    </div>
                    <div class="menu-separator"></div>
                    <div class="menu-section">
                        <h4>Configuration</h4>
                        <button id="menuShowCreator" class="menu-item" disabled>Formulaires</button>
                        <button id="menuShowModels" class="menu-item" disabled>Agents</button>
                        <button id="menuShowReports" class="menu-item" disabled>Rapports</button>
                    </div>
                </div>
            </div>
            <h1>EZIO<span class="badge-ia">IA Powered</span></h1>
        </div>
        <div class="header-center">
            <input type="text" id="searchInput" class="search-input" placeholder="ðŸ” Rechercher...">
            <div class="separator-vertical"></div>
            <button id="btnShowApp" class="btn-primary">Audit</button>
            <button id="btnShowDashboard" class="btn-primary">Tableau de Bord</button>
            <button id="btnToggleNotes" class="btn-secondary" title="Prises de notes">Notes</button>
            <button id="btnShowDeliveries" class="btn-secondary">Livrables</button>

        </div>
        <div class="header-right">
            <div class="separator-vertical"></div>
            <div class="separator-vertical"></div>
            <button id="themeBtn" class="btn-secondary" title="Changer de thÃ¨me">ðŸŒ™</button>
            <button id="btnDocs" class="btn-secondary" title="Ouvrir la documentation">?</button>
        </div>
    </header>

    <div id="app-container" class="app-container">
        <!-- Sidebar Handle (Hover Zone) -->
        <div id="sidebarHandle" class="sidebar-handle" title="Afficher le menu"></div>

        <!-- VUE : AUDIT (Formulaire) -->
        <div id="audit-view" class="view-section">
            <aside id="sidebar" class="sidebar">
                <div class="sidebar-header-row">
                    <h3 class="sidebar-title">Navigation</h3>
                    <button id="pinSidebarBtn" class="btn-icon-small" title="Ã‰pingler le menu">ðŸ“Œ</button>
                </div>
                <ul id="chapterList" class="chapter-list"></ul>
            </aside>
            <div class="content-area">
                <div id="tableContainer" class="table-responsive">
                    <div class="empty-state">
                        <p>Aucune donnÃ©e chargÃ©e.</p>
                        <p>Importez un fichier JSON existant ou crÃ©ez-en un nouveau.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- VUE : DASHBOARD -->
        <div id="dashboard-view" class="view-section hidden">
            <div class="dashboard-container">
                <div class="dashboard-header">
                    <h2>Tableau de Bord</h2>
                    <div class="dashboard-actions">
                        <button id="btnAddWidget" class="btn-primary">+ Ajouter un graphique</button>
                    </div>
                </div>
                <div id="dashboardGrid" class="dashboard-grid"></div>
            </div>
        </div>

        <!-- VUE : CREATEUR FORMULAIRE -->
        <div id="creator-view" class="view-section hidden">
            <div class="creator-container">
                <div class="creator-header">
                    <h2>GÃ©nÃ©rateur de Formulaire</h2>
                    <p>Transformez votre fichier JSON source en application d'audit intelligente.</p>
                    <div class="file-upload-box">
                        <label for="csvInput" class="btn-primary">ðŸ“‚ Importer un fichier de donnÃ©es</label>
                        <input type="file" id="csvInput" accept=".json" hidden>
                        <span id="csvFileName" class="file-name">Aucun fichier choisi</span>
                        <div class="separator-vertical"></div>
                        <button id="btnOpenAddCol" class="btn-secondary">+ Ajouter une colonne</button>
                    </div>
                </div>
                <div id="creatorConfig" class="creator-config hidden">
                    <div class="table-responsive">
                        <table id="configTable"></table>
                    </div>
                    <div class="creator-actions">
                        <button id="generateJsonBtn" class="btn-primary large">ðŸ’¾ GÃ©nÃ©rer et Charger le JSON</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW MODELS -->
        <div id="models-view" class="view-section hidden">
            <div class="manager-container">
                <!-- SIDEBAR -->
                <aside class="model-sidebar">
                    <div class="sidebar-actions">
                        <button id="btnNewModel" class="btn-primary" style="width: 100%;">+ Nouvel agent</button>
                    </div>
                    <div id="modelList" class="model-list">
                        <!-- Items injectÃ©s par JS -->
                    </div>
                    <div class="sidebar-actions">
                        <small style="color: var(--text-muted);">StockÃ© dans models.json</small>
                    </div>
                </aside>

                <!-- MAIN EDITOR -->
                <main id="editorArea" class="main-editor">
                    <div id="statusMsg" class="status-bar"></div>

                    <div id="emptyState" class="empty-selection">
                        <p>SÃ©lectionnez un modÃ¨le pour l'Ã©diter ou crÃ©ez-en un nouveau.</p>
                    </div>

                    <div id="editForm" class="hidden">
                        <div class="editor-card">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>Nom</label>
                                        <input type="text" id="inpName" class="form-control"
                                            placeholder="Ex: Assistant Audit">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>Description</label>
                                        <input type="text" id="inpDesc" class="form-control"
                                            placeholder="Courte description...">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Prompt SystÃ¨me (Instructions de base)</label>
                                <textarea id="inpPrompt" class="form-control" rows="5"
                                    placeholder="Tu es un expert..."></textarea>
                            </div>
                        </div>

                        <div class="editor-card">
                            <h3 style="margin-bottom: 15px; font-size: 1rem; color: var(--primary);">Configuration
                                Technique</h3>

                            <!-- Ligne 1 : Provider | Endpoint | API Key -->
                            <div class="form-row" style="align-items: flex-end;">
                                <div class="form-col" style="flex: 0 0 150px;">
                                    <div class="form-group">
                                        <label>Fournisseur</label>
                                        <select id="inpProvider" class="form-control">
                                            <option value="lmstudio">LM Studio (Local)</option>
                                            <option value="openai">OpenAI</option>
                                            <option value="mock">Mock</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>Endpoint API</label>
                                        <input type="text" id="inpEndpoint" class="form-control"
                                            placeholder="http://localhost:1234/v1/chat/completions">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>ClÃ© API</label>
                                        <input type="password" id="inpApiKey" class="form-control" placeholder="sk-...">
                                    </div>
                                </div>
                                <div class="form-col" style="flex: 0 0 auto;">
                                    <div class="form-group">
                                        <button id="btnTestConnection" class="btn-secondary"
                                            title="Tester la connexion et lister les modÃ¨les">
                                            Test âš¡
                                        </button>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>ID du ModÃ¨le</label>
                                        <!-- Utilisation d'un datalist pour faire office de ComboBox (Saisie libre + Choix) -->
                                        <input type="text" id="inpModelId" class="form-control" list="modelListOptions"
                                            placeholder="ex: gpt-4, mistral-small..." autocomplete="off">
                                        <datalist id="modelListOptions"></datalist>
                                    </div>
                                </div>
                            </div>


                            <!-- Ligne 3 : TempÃ©rature | Contexte -->
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>TempÃ©rature (0.0 - 1.0)</label>
                                        <input type="number" id="inpTemp" class="form-control" step="0.1" min="0"
                                            max="2" value="0.7">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>Contexte (Tokens)</label>
                                        <input type="number" id="inpContext" class="form-control" value="4096">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="editor-card"
                            style="text-align: right; background: transparent; border: none; box-shadow: none; padding: 0;">
                            <button id="btnDeleteModel" class="btn-danger">Supprimer</button>
                            <button id="btnSaveModel" class="btn-primary" style="padding: 10px 20px;">ðŸ’¾ Enregistrer les
                                modifications</button>
                        </div>
                    </div>
                </main>
            </div>
        </div>

        <!-- VIEW REPORTS -->
        <div id="reports-view" class="view-section hidden">
            <div class="reports-container">
                <aside class="reports-sidebar">
                    <!-- Sidebar content generated by app_reports.js -->
                </aside>
                <main class="reports-main">
                    <div class="reports-empty-state">
                        <p>SÃ©lectionnez un rapport ou un module pour commencer.</p>
                    </div>
                </main>
            </div>
        </div>
        <!-- VUE : LIVRABLES (DELIVERIES) -->
        <div id="deliveries-view" class="view-section hidden">
            <div class="deliveries-container">
                <div class="deliveries-sidebar"></div>
                <div class="deliveries-main"></div>
            </div>
        </div>
    </div> <!-- FIN APP CONTAINER -->

    <!-- NOTES CONTAINER -->
    <div id="notesContainer" class="notes-container hidden">
        <div class="notes-header">
            <h3>Notes</h3>
            <button id="btnCloseNotes" class="btn-icon">âœ–</button>
        </div>
        <textarea id="notesTextarea" placeholder="Vos notes ici..."></textarea>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.js"></script>

    <!-- App Module Entry Point -->
    <script type="module" src="js/main.js"></script>
</body>

</html>