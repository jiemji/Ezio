<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Technique & Fonctionnelle - Ezio</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg-body: #f8fafc;
            --bg-content: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 300px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-body: #0f172a;
                --bg-content: #1e293b;
                --text-main: #f1f5f9;
                --text-muted: #94a3b8;
                --border: #334155;
            }
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            line-height: 1.6;
        }

        /* Layout */
        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
        }

        /* Sidebar */
        .nav-sidebar {
            width: var(--sidebar-width);
            background-color: #1e293b;
            border-right: 1px solid var(--border);
            padding: 2rem;
            overflow-y: auto;
            order: 1;
            flex-shrink: 0;
            color: #f1f5f9;
        }

        .nav-sidebar h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #94a3b8;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .nav-sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-sidebar li {
            margin-bottom: 0.5rem;
        }

        .nav-sidebar a {
            text-decoration: none;
            color: #f1f5f9;
            font-size: 0.95rem;
            display: block;
            padding: 0.25rem 0;
            transition: color 0.2s;
        }

        .nav-sidebar a:hover {
            color: #38bdf8;
        }

        .nav-sidebar a.sub-link {
            padding-left: 1rem;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        /* Main Content */
        .content-area {
            flex: 1;
            padding: 3rem 4rem;
            overflow-y: auto;
            scroll-behavior: smooth;
            order: 2;
        }

        h1,
        h2,
        h3,
        h4 {
            color: var(--text-main);
        }

        h1 {
            font-size: 2.25rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        h2 {
            font-size: 1.75rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
        }

        h4 {
            font-size: 1.1rem;
            margin-top: 1.5rem;
        }

        p,
        ul {
            margin-bottom: 1rem;
        }

        /* Code Blocks */
        code {
            background-color: rgba(125, 125, 125, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, monospace;
        }

        pre {
            background-color: #1e293b;
            color: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: Consolas, monospace;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid;
        }

        .alert-note {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #1e40af;
        }

        @media (prefers-color-scheme: dark) {
            .alert-note {
                color: #93c5fd;
            }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        th,
        td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background-color: rgba(125, 125, 125, 0.05);
        }
    </style>
</head>

<body>

    <div class="container">
        <main class="content-area">
            <h1>Documentation Technique & Fonctionnelle - Ezio</h1>
            <p>Ezio est une application "Local-First" d'audit et de pilotage assist√© par IA. Cette documentation couvre
                le guide fonctionnel pour les utilisateurs, l'installation pour les d√©veloppeurs et l'architecture
                refondue.</p>

            <h2 id="guide-fonctionnel">1. Guide Fonctionnel (Par √âcran)</h2>
            <p>Ezio est con√ßu pour simplifier et automatiser la saisie d'audits, de formulaires complexes, et la
                g√©n√©ration de rapports via l'Intelligence Artificielle. Ce guide d√©crit les fonctions offertes par
                chaque √©cran.</p>

            <h3 id="screen-audit">1.1 √âditeur de Formulaire / Audit (Accueil)</h3>
            <p>C'est le c≈ìur de la saisie des donn√©es. Il se pr√©sente sous la forme d'un tableur dynamique interactif.
            </p>
            <ul>
                <li><strong>Cr√©ation du formulaire</strong> : D√©finition des colonnes libres (Texte, Liste d√©roulante,
                    Chapitre) via le bouton "G√©rer les colonnes".</li>
                <li><strong>Saisie en grille</strong> : Les utilisateurs peuvent ajouter des lignes (Constats,
                    Questions) et les remplir comme dans Excel.</li>
                <li><strong>Intervention IA (Baguette Magique ‚ú®)</strong> : Colonnes d√©di√©es (<code>ia</code>)
                    permettant de g√©n√©rer automatiquement un contenu √† partir des autres cellules de la ligne courante.
                </li>
                <li><strong>√âditeur de texte enrichi</strong> : Les grandes cellules peuvent √™tre √©dit√©es via un
                    mini-√©diteur Markdown pour une meilleure mise en page, et disposent aussi d'outils de "Traitement IA
                    rapide" (Traduction, Relecture) accessibles via la fen√™tre üõ†Ô∏è.</li>
                <li><strong>Filtres et Tris</strong> : Permet de filtrer l'affichage par chapitre ou sous-chapitre.</li>
            </ul>
            <div class="alert alert-note">
                <strong>Exemple d'utilisation :</strong> Un auditeur cyber d√©finit une colonne "Question", une
                "Constat", et une "Reco. (IA)". Il remplit 50 lignes, clique sur "G√©n√©rer tout" (ou ‚ú® par ligne), et
                l'IA r√©dige les recommandations adapt√©es. L'auditeur relit, modifie le texte via l'√©diteur enrichi, et
                le verrouille (üîí).
            </div>

            <h3 id="screen-dashboard">1.2 Dashboard (Tableau de bord interactif)</h3>
            <p>Construit automatiquement des graphiques statistiques √† partir des donn√©es saisies dans l'Audit.</p>
            <ul>
                <li><strong>Cr√©ation de Widgets (Graphiques)</strong> : Creer des camemberts, barres, etc.</li>
                <li><strong>Croisement de donn√©es matricielles</strong> : Chaque graphique permet de croiser deux
                    colonnes de l'audit.</li>
                <li><strong>Filtres</strong> : Chaque graphique peut √™tre restreint √† un "Chapitre".</li>
                <li><strong>Affichages personnalis√©s</strong> : Afficher valeurs brutes ou pourcentages. Option
                    d'inclusion aux rapports.</li>
            </ul>

            <h3 id="screen-modeles">1.3 Mod√®les de Rapports</h3>
            <p>G√®re la biblioth√®que logicielle des "briques" (Modules) qui serviront √† composer les livrables IA.</p>
            <ul>
                <li><strong>Gestion des Mod√®les</strong> : Cr√©er diff√©rents types de mod√®les finaux (ex: "Synth√®se
                    Manag√©riale").</li>
                <li><strong>Composition</strong> : Glisser/d√©poser des modules IA dans les mod√®les.</li>
                <li><strong>Scope</strong> : D√©finir si le module IA lit l'int√©gralit√© du formulaire ou un filtre
                    pr√©cis.</li>
            </ul>

            <h3 id="screen-livrables">1.4 Rapports / Livrables</h3>
            <p>Le moteur d'ex√©cution et de relecture finaux des mod√®les cr√©√©s pr√©c√©demment.</p>
            <ul>
                <li><strong>Cr√©ation de Livrable</strong> : Instancie un nouveau livrable depuis un Mod√®le.</li>
                <li><strong>G√©n√©ration IA</strong> : G√©n√©ration des textes et graphiques.</li>
                <li><strong>√âditeur WYSIWYG Global</strong> : L'utilisateur peut faire de la mise en page, corriger le
                    texte ou utiliser les "Outils IA" modaux (Traduire, Reformuler).</li>
            </ul>

            <h3 id="screen-impression">1.5 Impression (Exportation)</h3>
            <p>Le centre de compilation physique des donn√©es.</p>
            <ul>
                <li><strong>Injection Word (.docx)</strong> : Utilise des fichiers locaux Word comme gabarits et y coule
                    les textes g√©n√©r√©s et graphiques du Dashboard √† l'emplacement de <code>{{CONTENT}}</code>.</li>
                <li><strong>Export PowerPoint (.pptx)</strong> : G√©n√®re des slides structur√©es avec graphiques natifs.
                </li>
            </ul>

            <h3 id="screen-agents">1.6 Agents IA (Configuration)</h3>
            <p>L'espace d'administration technique de l'Intelligence Artificielle.</p>
            <ul>
                <li><strong>Verrouillage (üîí) & Outils (üõ†Ô∏è)</strong> : Prot√®ge les mod√®les ou les transforme en
                    "Macros" (outils rapides pour l'√©diteur Markdown).</li>
                <li><strong>Prompts Syst√®mes</strong> : D√©finition de l'√¢me du mod√®le.</li>
            </ul>

            <hr>

            <h2 id="installation">2. Installation en Local</h2>
            <p>L'application est con√ßue pour √™tre lanc√©e sans build complexe (No Webpack/Vite requis pour le runtime),
                mais n√©cessite un serveur HTTP local pour contourner les restrictions CORS des modules ES6.</p>

            <div class="alert alert-note">
                <strong>Pr√©-requis :</strong> Un navigateur moderne (Chrome, Edge, Firefox) et un environnement
                d'ex√©cution l√©ger (Python, Node.js ou extension Chrome).
            </div>

            <h3>2.1 D√©marrage Rapide</h3>
            <p>Ouvrez un terminal √† la racine du projet :</p>
            <pre><code># Avec Python 3
python -m http.server 8000

# Avec Node.js (http-server)
npx http-server .</code></pre>
            <p>Acc√©dez ensuite √† <code>http://localhost:8000</code>.</p>

            <hr>

            <h2 id="architecture">2. Architecture & Refactoring (Phase 5)</h2>
            <p>Le code a √©t√© restructur√© pour s√©parer clairement le C≈ìur (Logiciels de base), les Modules (Logique
                m√©tier) et l'UI. Des optimisations majeures (D√©l√©gation d'√©v√©nements, Debounce) ont √©t√© appliqu√©es en
                v2.2.1 pour la performance.</p>

            <h3 id="structure">2.1 Structure des Fichiers</h3>
            <table>
                <thead>
                    <tr>
                        <th>R√©pertoire</th>
                        <th>R√¥le</th>
                        <th>Fichiers Cl√©s</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>js/core/</code></td>
                        <td>Fondations</td>
                        <td>State.js, Utils.js, DataUtils.js, UIFactory.js</td>
                    </tr>
                    <tr>
                        <td><code>js/modules/</code></td>
                        <td>Fonctionnalit√©s</td>
                        <td>app_audit.js, AuditRenderer.js, app_reports.js, ReportsRenderer.js, app_deliveries.js</td>
                    </tr>
                    <tr>
                        <td><code>js/ui/</code></td>
                        <td>Interface</td>
                        <td>Navigation.js, Sidebar.js, Modal.js, MarkdownEditor.js</td>
                    </tr>
                    <tr>
                        <td><code>js/api/</code></td>
                        <td>Services</td>
                        <td>api_ia.js</td>
                    </tr>
                </tbody>
            </table>

            <h3 id="core-examples">2.2 Utilisation des Fonctions C≈ìur</h3>
            <p>Voici comment utiliser les nouvelles biblioth√®ques centrales introduites lors du refactoring.</p>

            <h4>UIFactory (Toasts & Composants)</h4>
            <p>Remplacez toutes les alertes natives par des Toasts non-bloquants.</p>
            <pre><code>import { UI } from '../core/UIFactory.js';

// Afficher une notification succ√©s
UI.showToast("Export r√©ussi !", "success");

// Afficher une erreur
UI.showToast("Fichier introuvable.", "danger");

// G√©n√©rer un badge HTML
const badgeHtml = UI.renderBadge("En cours", "#3b82f6");
// &lt;span class="badge" style="..."&gt;En cours&lt;/span&gt;</code></pre>

            <h4>DataUtils (Traitement de donn√©es pur)</h4>
            <p>D√©l√©guez les tris et filtres complexes √† ce module pour garder les contr√¥leurs l√©gers.</p>
            <pre><code>import { DataUtils } from '../core/DataUtils.js';

const rows = [ ["Chap1", "Non"], ["Chap1", "Oui"] ];
const columns = [ {id:"c1", type:"chapitre"}, {id:"c2", type:"combo"} ];

// Filtrer et trier
const results = DataUtils.processRows(
    rows, 
    columns, 
    { chapter: "Chap1" }, // Filtre actif
    {},                   // Filtres colonnes
    "Oui",                // Recherche texte
    { colIndex: 1, direction: 'asc' } // Tri
);

// results = [{ data: [...], originalIndex: 1 }]</code></pre>

            <h2 id="modules">3. Modules Fonctionnels</h2>

            <h3 id="mod-audit">3.1 Module Audit (Pattern MVC)</h3>
            <p>Le module Audit applique d√©sormais une s√©paration stricte :</p>
            <ul>
                <li><strong>Contr√¥leur (<code>app_audit.js</code>)</strong> : G√®re l'√©tat (State), les appels IA et la
                    logique m√©tier.</li>
                <li><strong>Vue (<code>AuditRenderer.js</code>)</strong> : Re√ßoit un contexte et g√©n√®re le HTML
                    (incluant le <code>MarkdownEditor</code> en mode compact pour l'√©dition de texte enrichie ligne par
                    ligne).</li>
            </ul>
            <pre><code>// Dans app_audit.js
import { AuditRenderer } from './AuditRenderer.js';

function renderTable() {
    const context = {
        currentForm,
        filters: { ... },
        actions: { handleSort, deleteRow, ... } // Bindings
    };
    AuditRenderer.render(container, context);
}</code></pre>

            <h3 id="mod-deliveries">3.2 Module Livrables (Async/Await & WYSIWYG)</h3>
            <p>Ce module g√®re un workflow complexe de g√©n√©ration de documents via IA.</p>
            <ul>
                <li><strong>Scope</strong> : S√©lectionne les chapitres √† analyser.</li>
                <li><strong>Context Build</strong> : Construit un tableau Markdown des donn√©es filtr√©es.</li>
                <li><strong>IA Call</strong> : Envoie le contexte + prompt au LLM (via <code>api_ia.js</code>).</li>
                <li><strong>√âditeur WYSIWYG</strong> : Le r√©sultat est √©ditable dans une zone de texte enrichi (Titres,
                    Listes, Tableaux redimensionn√©s) avec barre d'outils. L'√©diteur s'√©tire dynamiquement jusqu'au bas
                    de la fen√™tre apr√®s g√©n√©ration pour maximiser la zone de lecture (tout en restant redimensionnable).
                    La conversion bidirectionnelle du HTML visuel en Markdown garantit une persistance parfaite. Le
                    module "Triche" visuellement en omettant d'afficher le tableau complet de l'audit pour √©viter de
                    polluer l'√©diteur, et greffera proprement ce dernier au document complet exclusivement lors de
                    l'Impression ou de la Sauvegarde MD.
                </li>
                <li><strong>Outils IA (Baguette Magique ‚ú®)</strong> : Via une pop-up (Split-view), le texte peut √™tre
                    envoy√© √† un Agent configur√© en "Outil". Cela permet de scinder la relectures, la traduction ou
                    d'autres traitements de la g√©n√©ration initiale.</li>
            </ul>
            <pre><code>// Exemple de flux (simplifi√©)
async function generateModule(delivery) {
    try {
        const context = await buildContext(delivery.scope, auditData);
        const response = await ApiService.fetchLLM(modelConfig, [
            { role: 'system', content: prompt },
            { role: 'user', content: [instruction, context] }
        ]);
        delivery.result = response;
    } catch (e) {
        UI.showToast("Erreur IA: " + e.message, "danger");
    }
}</code></pre>

            <h3 id="mod-printing">3.3 Impression & Export (Module Unifi√©)</h3>
            <p>Le syst√®me d'impression remplace les anciens exports individuels.</p>
            <ul>
                <li><strong>Configuration</strong> : Le fichier <code>output_config.json</code> d√©finit les mod√®les
                    disponibles (Word et PPTX).</li>
                <li><strong>Word (.docx)</strong> : Utilise <code>docx</code> et <code>JSZip</code> pour injecter le
                    contenu format√© Markdown (et les tableaux de donn√©es cach√©s lors de la pr√©visualisation) dans des
                    mod√®les existants.</li>
                <li><strong>PowerPoint (.pptx)</strong> : Utilise <code>PptxGenJS</code> pour g√©n√©rer des slides
                    vectorielles int√©grant le m√™me contenu √©tendu.</li>
                <li><strong>Widgets & Graphiques</strong> : Durant l'Impression Word ou PPTX, les graphiques du
                    Dashboard s√©lectionn√©s pour l'export sont automatiquement t√©l√©charg√©s en images PNG renomm√©es √† la
                    vol√©e. Cela permet de les int√©grer d'un simple glisser-d√©poser au sein de vos rapports.</li>
            </ul>

            <h3 id="mod-reports">3.4 Module Rapports (Pattern MVC)</h3>
            <p>Le module Rapports g√®re les biblioth√®ques de modules IA et la composition des rapports. Il applique le
                pattern MVC :</p>
            <ul>
                <li><strong>Contr√¥leur (<code>app_reports.js</code>)</strong> : G√®re l'√©tat global et les actions
                    logiques (ajouts, suppressions, mouvements).</li>
                <li><strong>Vue (<code>ReportsRenderer.js</code>)</strong> : Construit l'interface HTML compl√®te et
                    centralise l'√©coute des actions utilisateur (Event Delegation).</li>
            </ul>

            <h3 id="mod-dashboard">3.5 Module Dashboard</h3>
            <p>Le tableau de bord permet l'analyse visuelle des donn√©es du formulaire :</p>
            <ul>
                <li><strong>√âditeur Avanc√© (Modale)</strong> : Interface centralis√©e pour configurer les graphiques avec
                    pr√©visualisation en temps r√©el via <code>Modal.js</code>.</li>
                <li><strong>Croisements Dynamiques Universels</strong> : Les axes principaux et secondaires acceptent
                    toutes les colonnes du formulaire (pas uniquement les listes √† choix), permettant une extraction
                    dynamique illimit√©e.</li>
                <li><strong>DataLabels & Formats</strong> : Support du plugin <code>chartjs-plugin-datalabels</code>
                    pour l'affichage des √©tiquettes (en couleurs contrast√©es). Choix d'affichage en <strong>Valeurs
                        Brutes</strong> ou <strong>Pourcentages (%)</strong>, avec mise √† l'√©chelle dynamique des
                    graduations locales (axe X cap√© √† 100%).</li>
            </ul>
        </main>

        <nav class="nav-sidebar">
            <h3>Menu</h3>
            <ul>
                <li><a href="#guide-fonctionnel">1. Guide Fonctionnel</a>
                    <ul>
                        <li><a href="#screen-audit" class="sub-link">1.1 Audit</a></li>
                        <li><a href="#screen-dashboard" class="sub-link">1.2 Dashboard</a></li>
                        <li><a href="#screen-modeles" class="sub-link">1.3 Mod√®les Rapports</a></li>
                        <li><a href="#screen-livrables" class="sub-link">1.4 Livrables</a></li>
                        <li><a href="#screen-impression" class="sub-link">1.5 Impression</a></li>
                        <li><a href="#screen-agents" class="sub-link">1.6 Agents IA</a></li>
                    </ul>
                </li>
                <li><a href="#installation">2. Installation</a></li>
                <li><a href="#architecture">3. Architecture</a>
                    <ul>
                        <li><a href="#structure" class="sub-link">3.1 Structure Fichiers</a></li>
                        <li><a href="#core-examples" class="sub-link">3.2 Code C≈ìur</a></li>
                    </ul>
                </li>
                <li><a href="#modules">4. Structure Code</a>
                    <ul>
                        <li><a href="#mod-audit" class="sub-link">4.1 Audit (MVC)</a></li>
                        <li><a href="#mod-deliveries" class="sub-link">4.2 Livrables (Async)</a></li>
                        <li><a href="#mod-printing" class="sub-link">4.3 Impression</a></li>
                        <li><a href="#mod-reports" class="sub-link">4.4 Mod√®les</a></li>
                        <li><a href="#mod-dashboard" class="sub-link">4.5 Dashboard</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>

</body>

</html>