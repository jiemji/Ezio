<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Technique & Fonctionnelle - Ezio</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg-body: #f8fafc;
            --bg-content: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --sidebar-width: 300px;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-body: #0f172a;
                --bg-content: #1e293b;
                --text-main: #f1f5f9;
                --text-muted: #94a3b8;
                --border: #334155;
            }
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            line-height: 1.6;
        }

        /* Layout */
        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            height: 100%;
        }

        /* Sidebar */
        .nav-sidebar {
            width: var(--sidebar-width);
            background-color: #1e293b;
            border-right: 1px solid var(--border);
            padding: 2rem;
            overflow-y: auto;
            order: 1;
            flex-shrink: 0;
            color: #f1f5f9;
        }

        .nav-sidebar h3 {
            font-size: 0.9rem;
            text-transform: uppercase;
            color: #94a3b8;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .nav-sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .nav-sidebar li {
            margin-bottom: 0.5rem;
        }

        .nav-sidebar a {
            text-decoration: none;
            color: #f1f5f9;
            font-size: 0.95rem;
            display: block;
            padding: 0.25rem 0;
            transition: color 0.2s;
        }

        .nav-sidebar a:hover {
            color: #38bdf8;
        }

        .nav-sidebar a.sub-link {
            padding-left: 1rem;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        /* Main Content */
        .content-area {
            flex: 1;
            padding: 3rem 4rem;
            overflow-y: auto;
            scroll-behavior: smooth;
            order: 2;
        }

        h1,
        h2,
        h3,
        h4 {
            color: var(--text-main);
        }

        h1 {
            font-size: 2.25rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        h2 {
            font-size: 1.75rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
        }

        h4 {
            font-size: 1.1rem;
            margin-top: 1.5rem;
        }

        p,
        ul {
            margin-bottom: 1rem;
        }

        /* Code Blocks */
        code {
            background-color: rgba(125, 125, 125, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: Consolas, monospace;
        }

        pre {
            background-color: #1e293b;
            color: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: Consolas, monospace;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border-left: 4px solid;
        }

        .alert-note {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #1e40af;
        }

        @media (prefers-color-scheme: dark) {
            .alert-note {
                color: #93c5fd;
            }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        th,
        td {
            border: 1px solid var(--border);
            padding: 0.75rem;
            text-align: left;
        }

        th {
            background-color: rgba(125, 125, 125, 0.05);
        }
    </style>
</head>

<body>

    <div class="container">
        <main class="content-area">
            <h1>Documentation Technique & Fonctionnelle - Ezio</h1>
            <p>Ezio est une application "Local-First" d'audit et de pilotage assisté par IA. Cette documentation couvre
                l'installation pour les développeurs et l'architecture refondue.</p>

            <h2 id="installation">1. Installation en Local</h2>
            <p>L'application est conçue pour être lancée sans build complexe (No Webpack/Vite requis pour le runtime),
                mais nécessite un serveur HTTP local pour contourner les restrictions CORS des modules ES6.</p>

            <div class="alert alert-note">
                <strong>Pré-requis :</strong> Un navigateur moderne (Chrome, Edge, Firefox) et un environnement
                d'exécution léger (Python, Node.js ou extension Chrome).
            </div>

            <h3>1.1 Démarrage Rapide</h3>
            <p>Ouvrez un terminal à la racine du projet :</p>
            <pre><code># Avec Python 3
python -m http.server 8000

# Avec Node.js (http-server)
npx http-server .</code></pre>
            <p>Accédez ensuite à <code>http://localhost:8000</code>.</p>

            <hr>

            <h2 id="architecture">2. Architecture & Refactoring (Phase 5)</h2>
            <p>Le code a été restructuré pour séparer clairement le Cœur (Logiciels de base), les Modules (Logique
                métier) et l'UI. Des optimisations majeures (Délégation d'événements, Debounce) ont été appliquées en
                v2.2.1 pour la performance.</p>

            <h3 id="structure">2.1 Structure des Fichiers</h3>
            <table>
                <thead>
                    <tr>
                        <th>Répertoire</th>
                        <th>Rôle</th>
                        <th>Fichiers Clés</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>js/core/</code></td>
                        <td>Fondations</td>
                        <td>State.js, Utils.js, DataUtils.js, UIFactory.js</td>
                    </tr>
                    <tr>
                        <td><code>js/modules/</code></td>
                        <td>Fonctionnalités</td>
                        <td>app_audit.js, AuditRenderer.js, app_deliveries.js, app_output_word.js</td>
                    </tr>
                    <tr>
                        <td><code>js/ui/</code></td>
                        <td>Interface</td>
                        <td>Navigation.js, Sidebar.js, Modal.js</td>
                    </tr>
                    <tr>
                        <td><code>js/api/</code></td>
                        <td>Services</td>
                        <td>api_ia.js</td>
                    </tr>
                </tbody>
            </table>

            <h3 id="core-examples">2.2 Utilisation des Fonctions Cœur</h3>
            <p>Voici comment utiliser les nouvelles bibliothèques centrales introduites lors du refactoring.</p>

            <h4>UIFactory (Toasts & Composants)</h4>
            <p>Remplacez toutes les alertes natives par des Toasts non-bloquants.</p>
            <pre><code>import { UI } from '../core/UIFactory.js';

// Afficher une notification succés
UI.showToast("Export réussi !", "success");

// Afficher une erreur
UI.showToast("Fichier introuvable.", "danger");

// Générer un badge HTML
const badgeHtml = UI.renderBadge("En cours", "#3b82f6");
// &lt;span class="badge" style="..."&gt;En cours&lt;/span&gt;</code></pre>

            <h4>DataUtils (Traitement de données pur)</h4>
            <p>Déléguez les tris et filtres complexes à ce module pour garder les contrôleurs légers.</p>
            <pre><code>import { DataUtils } from '../core/DataUtils.js';

const rows = [ ["Chap1", "Non"], ["Chap1", "Oui"] ];
const columns = [ {id:"c1", type:"chapitre"}, {id:"c2", type:"combo"} ];

// Filtrer et trier
const results = DataUtils.processRows(
    rows, 
    columns, 
    { chapter: "Chap1" }, // Filtre actif
    {},                   // Filtres colonnes
    "Oui",                // Recherche texte
    { colIndex: 1, direction: 'asc' } // Tri
);

// results = [{ data: [...], originalIndex: 1 }]</code></pre>

            <h2 id="modules">3. Modules Fonctionnels</h2>

            <h3 id="mod-audit">3.1 Module Audit (Pattern MVC)</h3>
            <p>Le module Audit applique désormais une séparation stricte :</p>
            <ul>
                <li><strong>Contrôleur (<code>app_audit.js</code>)</strong> : Gère l'état (State), les appels IA et la
                    logique métier.</li>
                <li><strong>Vue (<code>AuditRenderer.js</code>)</strong> : Reçoit un contexte (données + actions) et
                    génère le HTML.</li>
            </ul>
            <pre><code>// Dans app_audit.js
import { AuditRenderer } from './AuditRenderer.js';

function renderTable() {
    const context = {
        currentForm,
        filters: { ... },
        actions: { handleSort, deleteRow, ... } // Bindings
    };
    AuditRenderer.render(container, context);
}</code></pre>

            <h3 id="mod-deliveries">3.2 Module Livrables (Async/Await & WYSIWYG)</h3>
            <p>Ce module gère un workflow complexe de génération de documents via IA.</p>
            <ul>
                <li><strong>Scope</strong> : Sélectionne les chapitres à analyser.</li>
                <li><strong>Context Build</strong> : Construit un tableau Markdown des données filtrées.</li>
                <li><strong>IA Call</strong> : Envoie le contexte + prompt au LLM (via <code>api_ia.js</code>).</li>
                <li><strong>Éditeur WYSIWYG</strong> : Le résultat est éditable dans une zone de texte enrichi (Titres,
                    Listes, Tableaux redimensionnés) avec barre d'outils. L'éditeur s'étire dynamiquement jusqu'au bas
                    de la fenêtre après génération pour maximiser la zone de lecture (tout en restant redimensionnable).
                    La conversion bidirectionnelle du HTML visuel en Markdown garantit une persistance parfaite. Le
                    module "Triche" visuellement en omettant d'afficher le tableau complet de l'audit pour éviter de
                    polluer l'éditeur, et greffera proprement ce dernier au document complet exclusivement lors de
                    l'Impression ou de la Sauvegarde MD.
                </li>
            </ul>
            <pre><code>// Exemple de flux (simplifié)
async function generateModule(delivery) {
    try {
        const context = await buildContext(delivery.scope, auditData);
        const response = await ApiService.fetchLLM(modelConfig, [
            { role: 'system', content: prompt },
            { role: 'user', content: [instruction, context] }
        ]);
        delivery.result = response;
    } catch (e) {
        UI.showToast("Erreur IA: " + e.message, "danger");
    }
}</code></pre>

            <h3 id="mod-printing">3.3 Impression & Export (Module Unifié)</h3>
            <p>Le système d'impression remplace les anciens exports individuels.</p>
            <ul>
                <li><strong>Configuration</strong> : Le fichier <code>output_config.json</code> définit les modèles
                    disponibles (Word et PPTX).</li>
                <li><strong>Word (.docx)</strong> : Utilise <code>docx</code> et <code>JSZip</code> pour injecter le
                    contenu formaté Markdown (et les tableaux de données cachés lors de la prévisualisation) dans des
                    modèles existants.</li>
                <li><strong>PowerPoint (.pptx)</strong> : Utilise <code>PptxGenJS</code> pour générer des slides
                    vectorielles intégrant le même contenu étendu.</li>
                <li><strong>Widgets & Graphiques</strong> : Durant l'Impression Word ou PPTX, les graphiques du
                    Dashboard sélectionnés pour l'export sont automatiquement téléchargés en images PNG renommées à la
                    volée. Cela permet de les intégrer d'un simple glisser-déposer au sein de vos rapports.</li>
            </ul>

            <h2 id="features">4. Fonctionnalités Clés</h2>

            <h3>4.1 Gestion des Données (JSON)</h3>
            <p>L'état est persistant via <code>localStorage</code>. Structure type :</p>
            <pre><code>{
  "columns": [ { "id": "c1", "type": "combo", "label": "Conformité" } ],
  "rows": [ ["R1", "Non"] ],
  "reports": [ /* Livrables générés */ ]
}</code></pre>

            <h3>4.2 Assistant IA</h3>
            <ul>
                <li><strong>Configuration</strong> : Fichier <code>models.json</code> à la racine.</li>
                <li><strong>Providers</strong> : Compatible OpenAI, Groq, et <strong>LM Studio</strong> (Local).</li>
            </ul>

            <h3 id="printing-features">4.3 Impression & Rapports</h3>
            <p>La nouvelle interface d'impression unifiée permet de générer des livrables professionnels.</p>
            <ul>
                <li><strong>Format Word</strong> : Support des modèles <code>.docx</code> et <code>.dotx</code> pour
                    conserver votre identité visuelle.</li>
                <li><strong>Format PowerPoint</strong> : Génération de présentations basées sur des thèmes
                    configurables.</li>
            </ul>
            <div class="alert alert-note">
                <strong>Guide de Configuration :</strong> Pour apprendre à créer vos propres modèles, consultez le <a
                    href="OUTPUT_CONFIG_GUIDE.md" target="_blank">Guide de Configuration des Sorties</a>.
            </div>

        </main>

        <nav class="nav-sidebar">
            <h3>Menu</h3>
            <ul>
                <li><a href="#installation">1. Installation</a></li>
                <li><a href="#architecture">2. Architecture</a>
                    <ul>
                        <li><a href="#structure" class="sub-link">Structure Fichiers</a></li>
                        <li><a href="#core-examples" class="sub-link">Exemples Code Cœur</a></li>
                    </ul>
                </li>
                <li><a href="#modules">3. Modules</a>
                    <ul>
                        <li><a href="#mod-audit" class="sub-link">3.1 Audit (MVC)</a></li>
                        <li><a href="#mod-deliveries" class="sub-link">3.2 Livrables (Async)</a></li>
                        <li><a href="#mod-printing" class="sub-link">3.3 Impression</a></li>
                    </ul>
                </li>
                <li><a href="#features">4. Fonctionnalités</a>
                    <ul>
                        <li><a href="#printing-features" class="sub-link">4.3 Impression</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>

</body>

</html>